<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE merge [ <!ENTITY fo-related "pdf/postscript/rtf"> ]>
<!-- $Id: autopoweroff.xml,v 1.10 2005/10/16 18:28:55 deragon Exp $ -->
<document>

<document-meta-info>
  <title>Autopoweroff: User Guide</title>
  <attribute name="Author"><a href="mailto:hans@deragon.biz">Hans Deragon</a></attribute>
  <attribute name="Company"><a href="http://www.deragon.biz">Deragon Informatique inc.</a></attribute>
  <attribute name="Revision">$Revision: 1.10 $</attribute>
  <attribute name="Last Modified">$Date: 2005/10/16 18:28:55 $</attribute>
</document-meta-info>

<!-- formating info -->
<document-formatting-info>
  <stylesheet url="style.css" />
  <left-margin>40pt</left-margin>
  <right-margin>40pt</right-margin>
  <top-margin>20pt</top-margin>
  <bottom-margin>25pt</bottom-margin>
  <body-font-family>Helvetica</body-font-family>
  <body-font-size>12pt</body-font-size>
  <document-title-font-family>Helvetica</document-title-font-family>
  <document-title-font-size>16pt</document-title-font-size>
  <document-attributes-font-family>Helvetica</document-attributes-font-family>
  <document-attributes-font-size>12pt</document-attributes-font-size>
  <section-header-font-family>Helvetica</section-header-font-family>
  <generate-section-numbers>yes</generate-section-numbers>
  <header-height>75pt</header-height>
  <footer-height>50pt</footer-height>
</document-formatting-info>

<!-- document header -->
<!--
<document-header>
<table width="100%"><tr><td align="left"><img src="logo_auriga.gif" alt="Aurigalogic: Smart Business Solutions"/></td>
<td valign="middle" align="right"><b>Autopoweroff: User Guide</b></td></tr>
</table>
<hr size="1" color="red" noshade="true" />
</document-header>
-->
<document-header>
<table width="100%"><tr><td align="left">
  <a href="http://www.deragon.biz">Deragon Informatique inc.</a>
</td>
<td valign="middle" align="right">
<b>Autopoweroff: User Guide</b>
<br/>
<a href="http://sourceforge.net"><img src="http://sourceforge.net/sflogo.php?group_id=77254&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"/></a>
</td></tr>
</table>
<hr size="1" color="red" noshade="true" />
</document-header>

<document-body>
<!-- meta info -->
<table-of-content>
<link href="#what_is">What is Autopoweroff</link>
<link href="#distributions">Supported distributions</link>
<link href="#download">Download</link>
<link href="#config_autopoweroff_gui">Screenshots</link>
<link href="#installation">Installation</link>
<link href="#deinstallation">Deinstallation</link>
<link href="#configuration">Configuration
  <link href="#config_autopoweroff">Autopoweroff configuration
    <link href="#config_autopoweroff_gui">Autopoweroff GUI configuration tool</link>
    <link href="#config_autopoweroff_file">Autopoweroff configuration file (autopoweroff.conf)</link>
  </link>
  <link href="#config_bios">BIOS configuration</link>
</link>
<link href="#todo">To do</link>
<link href="#change_history">Change History
  <link href="#changes_2.1.0">Version 2.1.0</link>
  <link href="#changes_2.0.0">Version 2.0.0</link>
  <link href="#changes_1.2.0">Version 1.2.0</link>
  <link href="#changes_1.1.1">Version 1.1.1</link>
  <link href="#changes_1.1.0">Version 1.1.0</link>
  <link href="#changes_1.0.1">Version 1.0.1</link>
</link>
<link href="#license">License</link>
<link href="#contact">Contact</link>
</table-of-content>

<section name="what_is" label="What is Autopoweroff">

<p>

  Autopoweroff is daemon that is started at boot time, and which
  function is to shutdown the computer at a specific time, but 
  only if some conditions are met.  This software is meant for
  the Linux operating system.

</p>
<p>

  The computer will shutdown if all the above conditions are met:

</p>

<ol>

    <li>

    Any hosts that the computer is dependant on is not
    answering ping anymore.

    </li>

    <li>

    No keyboard or mouse activity has been detected on the computer for
    a while (this only works for PS/2 keyboards and PS/2 &amp; serial mices;
    USB devices are not yet supported, unfortunatly).

    </li>

    <li>

    The user has not disabled Autopoweroff.

    </li>

</ol>

<p>

  One good use of Autopoweroff is for home use, on a firewall/router
  server.  You can setup Autopoweroff to shutdown the server every
  evening at say, 22:00.  However, your server might serve other
  computers in your home.  Autopoweroff will shutdown the server after
  22:00 only if no other computer on the network is responding to
  <code>ping</code>.  For example, if at 22:43 you are still working on
  your thin client in the living room, the server in your baseman will
  remain up.  As soon as you shutdown the workstation, the server will
  go down.

</p>
<p>

  The server can boot automatically every morning by setting its BIOS
  properly.  Autopoweroff has nothing to do with this process.  But with
  this setting, your home server does not need to run 24/7.  The advantages
  such a setting offers are:

  <ol>

    <li>

      Increase security.  Nobody can hack your server while its shutdown.

    </li>
    <li>

      Save electricity and curb down heat generation.

    </li>
    <li>

      Cut down noise.  A shutdown server does not produce any noise.

    </li>
    <li>

      Avoid the hassle of having to shut down and start up the server
      manually.

    </li>
  </ol>

</p>
<p>

  A nice GUI is provided to configure Autopoweroff's parameters.  See
  <section-link href="#config_autopoweroff_gui">Autopoweroff configurator</section-link>.

</p>
<p>

  The SourceForge page for this project can be found 
  <a href="http://sourceforge.net/projects/autopoweroff/">here</a>.

</p>

<table width="100%">
  <tr>
    <td valign="top" width="130">

      <p class="warning">
        HELP WANTED
      </p>

    </td>
    <td>

      <p>

      USB keyboards and mice are not yet supported.  I simply do not know
      how to implement activity detection with these devices.  If you have
      any clue how to do this, please share your ideas with me.

      </p>

    </td>
  </tr>
</table>


</section>

<section name="distributions" label="Supported distributions">

<p>

  Autopoweroff will work on most distributions.  However, for some
  distribution you might have to manually move files to the right place
  to get it working and write your own init script so that Autopoweroff
  would start at booting.  If you install Autopoweroff from the tarball,
  this is more likely.

</p>
<p>

  Fully supported distributions include:  <b>Red Hat</b> and
  <b>Mandrake</b>.  Download the rpm and everything will be installed
  and enabled automatically.  This include a <code>chkconfig --add
  autopoweroff</code> that will be performed upon installation, and
  which will enable Autopoweroff at booting time.  Off course, it is
  removed if you remove the RPM.

</p>
<p>

  With the rpm, you will only have to run the GUI configuration tool or
  edit <code>/etc/autopoweroff.conf</code> to your particular needs.

</p>
<table width="100%">
  <tr>
  <td valign="top" width="130">
    <p class="warning">
    HELP WANTED
    </p>
    </td>
    <td>

    <p>

    If you are running a distribution based on Red Hat, but that is not
    yet supported by Autopoweroff, write to me.  I will ask you some
    questions about your distribution and probably be able to add
    support for it in the next RPM release.

    </p>
    <p>

    This is particularly the case for Fedora.  If you use Fedora, please
    send me the equivalent of /etc/redhat-release file.  I might then be
    able to add this distribution to the list of supported
    distributions.

    </p>

    <p>

    I am seeking someone that could write a debian package for this
    application.  Once the package definition file created, I will
    maintain it if its not too complicated.  Any volunteers?

    </p>

  </td>
  </tr>
</table>

</section>


<section name="download" label="Download">

<p>

  The latest version of Autopoweroff can be downloaded from
  <a href="http://sourceforge.net/project/showfiles.php?group_id=74727">
  SourceForge</a>.

</p>

</section>

<section name="installation" label="Installation">

<p>

  To install the RPM, simply run:

</p>

<blockquote>
  <code>
  rpm -Uhv autopoweroff.rpm
  </code>
</blockquote>

<p>

  For the tarball, extract it and run <code>configure</code> followed
  by <code>make install</code>.

</p>

<blockquote>
  <code>

  tar xvzf autopoweroff.tar.gz
<br/>
  cd autopoweroff
<br/>
  configure
<br/>
  make install

  </code>
</blockquote>

</section>

<section name="deinstallation" label="Deinstallation">

<p>

  To deinstall the RPM, simply run:

</p>

<blockquote>
  <code>
  rpm -e autopoweroff.rpm
  </code>
</blockquote>

<p>

  If you installed from the tarball, run
</p>

<blockquote>
  <code>
  autopoweroff_uninstall
  </code>
</blockquote>

<p>

<table width="100%">
<tr>
<td valign="top" width="130">
  <p class="warning">
  DEVELOPERS
  </p>
  </td>
  <td>
  <p>

    Take this project as an example.  If you distribute your software with
    a tarball, provide an easy solution to de-install it.  Either
    provide a script like Autopoweroff is doing, or provide a "make
    uninstall" target.

  </p>
  </td>
  </tr>
</table>

</p>

</section>

<section name="configuration" label="Configuration">

<br/>

  Following are subsections that explains how to configure your system for
  Autopoweroff.

</section>

<section name="config_autopoweroff" label="Autopoweroff configuration">

<p>
  There are two ways to configure Autopoweroff.

  <ol>
    <li>
      Use the <section-link href="#config_autopoweroff_gui">GUI configuration tool</section-link>.

    </li>
    <li>
      Edit manually the configuration file <section-link href="#config_autopoweroff_file"><code>autopoweroff.conf</code></section-link>.
    </li>
  </ol>
</p>

Following, the list of sub-sections.

</section>

<section name="config_autopoweroff_gui" label="Autopoweroff GUI configuration tool">

<p>

  The Autopoweroff GUI configuration tool is pretty easy.

</p>
<p>

  In the first panel named <em>Status &amp; Commands</em>,
  the user can enable or disable Autopoweroff and poweroff
  or reboot the computer.

</p>

<blockquote>
<table>
  <tr width="600">
    <td align="center">
      <img src="autopoweroff_cfg-statusandcmd.png" alt="Status &amp; Commands screenshot"/>
    </td>
  </tr>
  <tr>
    <td align="center">
      <i>Status &amp; commands</i>
    </td>
  </tr>
</table>
</blockquote>
<p>

  In the second panel named <em>Status &amp; Commands</em>, the user can
  configure the different parameters of Autopoweroff.  See <section-link
  href="#config_autopoweroff_file">Autopoweroff configuration
  file</section-link> for a description of the different parameters.

</p>
<blockquote>
<table>
  <tr width="600">
    <td align="center">
      <img src="autopoweroff_cfg-config.png" alt="Configuration screenshot"/>
    </td>
  </tr>
  <tr>
    <td align="center">
      <i>Configuration</i>
    </td>
  </tr>
</table>
</blockquote>
<p align="center">


</p>

</section>


<section name="config_autopoweroff_file" label="Autopoweroff configuration file (autopoweroff.conf)">

<p>

  The <code>/etc/autopoweroff.conf</code> (or
  <code>${prefix}/etc/autopoweroff.conf</code>, for those who installed
  from the tarball) configuration file is well documented and easy to
  understand.  Following is an example:

</p>

<blockquote>
<pre>
# Autopoweroff X.Y.Z configuration file.
                                                                                
# WARNING:  If you decide to edit this file, edit only the values of the
#           parameters.  If you add comments, they will be lost at the
#           next software upgrade or when the GUI configurator is being
#           used to update the file.  Only values persists.
                                                                                
                                                                                
# start and end parameters (expressed in hours):
#
#   Following is the time range where the computer should not shutdown
#   even if all conditions are met.  In this example where start=5 and
#   end=22, the computer will not shut down between 05:00 and 22:00,
#   local time.
                                                                                
[NO_SHUTDOWN_TIME_RANGE]
start=5
end=22
                                                                                
                                                                                
# startup_delay parameter (expressed in minutes):
#
#   When the computer is booting up, if all the conditions are met and
#   the computer is in the shutdown time range, as soon as Autopoweroff
#   is started, the computer will shutdown.  Thus, the user will never
#   have the chance to boot into the computer.  This is where the
#   "delay" parameter comes in.  If "delay" is set to 15 for example,
#   Autopoweroff will not poweroff the computer even if all the
#   conditions are met, for a period of 15 minutes after the computer
#   has booted.  This allows the user to login and change Autopoweroff's
#   configuration.
#
#
# idle_time parameter (expressed in minutes):
#
#   Like a screensaver, Autopoweroff detects keyboard and mouse
#   activity, and if there is any activity on the server, it would not
#   be powered off regardless if all the other conditions are met.  If
#   set to 0, user activity on the server will be ignored.
#
#   For the moment, PS/2 keyboards and PS/2 &amp; serial mices have been tested.
#   Unfortunatly, USB keyboards and mices are not supported yet (I do not
#   know how to implement activity detection on these devices).  

[TIMEOUTS]
startup_delay=15
idle_time=5
                                                                                
                                                                                
# host parameter (list of hostnames or IPs, separated by commas):
#
#   Here you list the list of hosts your machine is dependant, i.e. this
#   computer should not shutdown if any of the hosts declared here is
#   still up (responding to ping).
                                                                                
[DEPENDANTS]
hosts=snahwin, snah
</pre>
</blockquote>


</section>

<section name="config_bios" label="BIOS configuration">

<p>

  It is possible to setup the BIOS so that the computer will boot
  itself every day.  Each BIOS is different, but they are pretty much
  similar.  Following are the instructions on how to setup an Award
  BIOS.

</p>
<p>

  On the main page, select the menu <em>POWER</em>, then the
  <em>POWER UP CONTROL</em> item.  Once the new screen shows up,
  move the cursor to the <em>Automatic Power Up</em> line and select
  <em>Everyday</em>.  On the following line, set the time at which
  the computer should start everyday.  Save the settings and voilà.

</p>

</section>


<section name="todo" label="To do">

<p>

The following are features to be added in future releases.

</p>

<ul>

<li>

<p>

  Support USB devices (keyboards and mices) for detecting user idle
  time.  Currently, Autopoweroff detects activity on PS/2 keyboards and
  PS/2 &amp; serial mices (AT keyboards probably work too).  USB devices are
  ignored.

</p>

<p>

  If anybody knows how to detect user activity on USB devices, please
  inform me.  I would be mostly happy to implement this.  Myself, I do
  not own any USB devices, so I cannot figure out how this works.

</p>

</li>
<li>

  Detect activity from a remote login, either it be console or an X session.
  Currently, if someone is working remotly on the computer, this will go
  undetected and Autopoweroff will proceed with the shutdown if all other
  conditions are met.

</li>
<li>

  Internationalization (i18n).  The Autopoweroff configurator tool (the
  GUI) is not translated into french.

</li>
<li>

  Better documentation, including writing a man page.  Anybody knows of a
  good tool to write man pages with?

</li>
<li>

<p>
  Add detection for other Red Hat compatible distributions when
  installing with the RPM.  If your system is not Red Hat or Mandrake,
  tell me what file need to be read on that system to figure out what
  version is running.  Under redhat, the file is /etc/redhat-release.
</p>

<p>
  Particularly, Fedora is yet not supported simply because I do not know the
  equivalent /etc/redhat-release file for this distribution.  If you can,
  please email me a copy.
</p>
 

</li>
</ul>

</section>

<section name="change_history" label="Change history">

<br/>

The following changes have been incorporated in the below mentioned versions:


</section>

<section name="changes_2.1.0" label="Version 2.1.0 - 2004/01/19">

<ul>

  <li>

    Like a screensaver, Autopoweroff now detects idle time on the server
    by scanning for keyboard and mouse activity.  Currently, PS/2
    keyboards and PS/2 &amp; serial mices are supported (USB devices are
    unfortunatly not detected yet).

  </li>

  <li>

    Added automatic configuration file upgrade.  If you upgrade Autopoweroff
    and autopoweroff.conf configuration file format has changed, it will
    automatically be upgraded to the new format while preserving the
    previous configuration.

  </li>

  <li>

    If Autopoweroff, upon startup, discovers that another instance of
    itself is already running, instead of quiting it kills the old
    instance and continues.

  </li>

  <li>

    Replaced calls to "reboot" and "poweroff" with their corresponding
    "shutdown" command.  Some user wrote to me asking where reboot and
    poweroff could be obtained, so I assume that they are not always
    available.

  </li>


</ul>
</section>

<section name="changes_2.0.0" label="Version 2.0.0 - 2003/11/23">

<ul>

  <li>

    Created a user interface to simplify configuration.  See
    <section-link href="#config_autopoweroff_gui">
      Autopoweroff GUI configuration tool
    </section-link>.

  </li>

  <li>

    Miscelleanous Autopoweroff events are now reported in syslog, for
    tracking purposes.

  </li>

  <li>

    Removed Gnome dependency, for servers running in text mode only.

  </li>


</ul>

</section>
<section name="changes_1.2.0" label="Version 1.2.0 - 2003/06/07">

<ul>

  <li>

    Fixed *.desktop files so that the icons now appear in the gnome
    "system tools" menu even if no locale is set.

  </li>

</ul>

</section>

<section name="changes_1.1.1" label="Version 1.1.1 - 2003/05/03">

<ul>

  <li>

    RPM installation now fully recognize Mandrake.

  </li>

  <li>

    Improved the Autopoweroff Configuration section of the document and
    the comments in /etc/autopoweroff.conf.

  </li>

  <li>

    Added the <code>Supported distributions</code> section.

  </li>

</ul>

</section>

<section name="changes_1.1.0" label="Version 1.1.0 - 2003/04/27">

<ul>

  <li>

    Automatic Gnome installation.  Under Red Hat 9.0, the cancel and
    enable scripts now have icons showing up under the "System tools"
    menu.

  </li>

  <li>

    Improved the installation and deinstallation of the software from
    a tarball.

  </li>

</ul>

</section>

<section name="changes_1.0.1" label="Version 1.0.1 - 2003/04/14">

<ul>

  <li>

    Used autoconf to allow installation from a tarball.

  </li>

  <li>

    Started using <a href="http://aurigadoc.sourceforge.net/">AurigaDoc</a>
    for creating this document.

  </li>

</ul>

</section>

<section name="license" label="License">

<p>

  This software is covered by the 

  <a href="http://www.gnu.org/licenses/gpl.html#TOC1">GPL</a>

  license.  For a local copy of the license, see file
  COPYING.

</p>

</section>

<section name="contact" label="Contact">

<p>

  If you have any questions or issues with this software, you can contact
  the following persons:

</p>


<blockquote>
<table>
  <tr>
    <td>
      Author:
    </td>
    <td>
      Hans Deragon
    </td>
  </tr>
  <tr>
    <td>
      Email:
    </td>
    <td>
      <a href="mailto:hans@deragon.biz">hans@deragon.biz</a>
    </td>
  </tr>
  <tr>
    <td>
      Website: 
    </td>
    <td>
      <a href="http://www.deragon.biz">www.deragon.biz</a>
    </td>
  </tr>
</table>
</blockquote>

</section>
</document-body>
</document>
